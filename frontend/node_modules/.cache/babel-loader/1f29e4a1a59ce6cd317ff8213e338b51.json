{"ast":null,"code":"var mapSize = 1200;\n\nfunction getRandomColor() {\n  var letters = '6789ABCDEF';\n  var color = '#';\n  let i = Math.floor(Math.random() * 3);\n\n  for (let j = 0; j < 3; j++) {\n    if (j == i) color += 'FF';else for (var k = 0; k < 2; k++) {\n      color += letters[Math.floor(Math.random() * 10)];\n    }\n  }\n\n  return color;\n}\n\nclass Pos {\n  constructor(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  static randomPos() {\n    let x = Math.random() * 2 * mapSize - mapSize;\n    let y = Math.random() * 2 * mapSize - mapSize;\n    return new Pos(x, y);\n  }\n\n  dist(v) {\n    return Math.pow((this.x - v.x) * (this.x - v.x) + (this.y - v.y) * (this.y - v.y), 0.5);\n  }\n\n  move(dx, dy) {\n    this.x += dx;\n    this.y += dy;\n  }\n\n  movev(v) {\n    this.x += v.x;\n    this.y += v.y;\n  }\n\n  add(x, y) {\n    let i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n    return new Pos(this.x + x * i, this.y + y * i);\n  }\n\n  addv(v) {\n    let i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    return new Pos(this.x + v.x * i, this.y + v.y * i);\n  }\n\n  rot(center, angle) {\n    let clockwise = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n    // center point, angle in radian\n    if (clockwise) angle *= -1;\n    const x = this.x - center.x;\n    const y = this.y - center.y;\n    this.x = Math.cos(angle) * x - Math.sin(angle) * y + center.x;\n    this.y = Math.sin(angle) * x + Math.cos(angle) * y + center.y;\n  }\n\n}\n\nclass Player {\n  constructor(name) {\n    this.name = name;\n    this.pos = new Pos(0, 0);\n    this.r = 25;\n    this.sw_angle = 0 * (Math.PI / 180); // sword angle\n\n    this.sw_r = 80; // sword radius\n\n    this.sw_w = 40;\n    this.sw_h = 100;\n    this.sw_speed = 4 * (Math.PI / 180);\n    this.hp = 100;\n    this.xp = 0;\n    this.color = getRandomColor();\n  }\n\n  static randomPlayer() {\n    function randomName() {\n      let alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\n      let name = '';\n\n      for (let i = 0; i < 10; i++) name += alphabet[Math.floor(Math.random() * alphabet.length)];\n\n      return name;\n    }\n\n    let p = new Player(randomName());\n    p.pos = Pos.randomPos();\n    return p;\n  }\n\n  trytohit(enemy) {\n    let sp = this.sw_pos();\n    let w = this.sw_w;\n    let h = this.sw_h;\n\n    function pos_x_line_meet(p1, p2, p) {\n      return (p.y - p1.y) * (p.x - p2.x) / (p1.y - p2.y) + p1.x > p.x && (p.y - p1.y) * (p.y - p2.y) < 0;\n    }\n\n    function line_circle_meet(p1, p2, p, r) {\n      let a = p2.y - p1.y,\n          b = p1.x - p2.x,\n          c = p1.x * (p1.y - p2.y) + p1.y * (p2.x - p1.x);\n      let d = Math.abs(a * p.x + b * p.y + c) / Math.pow(a * a + b * b, 0.5);\n      return d < r;\n    }\n\n    let meet_cnt = 0;\n    let dir = [1, 1];\n\n    for (let i = 0; i < 4; i++) {\n      let p1 = new Pos(sp.x + w * dir[0], sp.y + h * dir[1]);\n      let p2 = new Pos(sp.x + w * dir[0], sp.y - h * dir[1]);\n      if (pos_x_line_meet(p1, p2, enemy.pos)) meet_cnt++;\n\n      if (line_circle_meet(p1, p2, enemy.pos, enemy.r)) {\n        meet_cnt = 1;\n        break;\n      }\n\n      let tmp = dir[0];\n      dir[0] = -dir[1];\n      dir[1] = tmp;\n    }\n\n    return meet_cnt % 2 === 1;\n  }\n\n  trytoeat(item) {\n    const p = this.pos;\n    const i = item.pos;\n    return Math.pow(i.x - p.x, 2) + Math.pow(i.y - p.y, 2) <= Math.pow(this.r + item.r, 2);\n  }\n\n  move(dx, dy) {\n    this.pos.move(dx, dy);\n    this.bound();\n  }\n\n  bound() {\n    if (this.pos.x >= mapSize) this.pos.x = mapSize;\n    if (this.pos.y >= mapSize) this.pos.y = mapSize;\n    if (this.pos.x <= -mapSize) this.pos.x = -mapSize;\n    if (this.pos.y <= -mapSize) this.pos.y = -mapSize;\n  }\n\n  sw_rot(angle) {\n    let clockwise = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    if (clockwise) angle *= -1;\n    this.sw_angle += angle;\n    this.sw_angle %= 2 * Math.PI;\n  }\n\n  sw_pos() {\n    return this.pos.add(this.sw_r, 0).rot(this.pos, this.sw_angle);\n  }\n\n  hp_change(dhp) {\n    this.hp += dhp;\n  }\n\n  dead() {\n    return this.hp <= 0;\n  }\n\n}\n\nclass Item {\n  constructor(pos) {\n    this.pos = pos;\n    this.color = getRandomColor();\n    this.xp = Math.floor(Math.random() * 16) + 1;\n    this.r = Math.floor(Math.random() * 3) + 3;\n  }\n\n  static randomItem() {\n    return new Item(Pos.randomPos());\n  }\n\n  eaten(player) {\n    player.xp += this.xp;\n    this.constructor(Pos.randomPos());\n  }\n\n}\n\nexport { Player, Pos, Item };","map":{"version":3,"sources":["/Users/hong-eungi/git/tourne-sabre/frontend/src/object.js"],"names":["mapSize","getRandomColor","letters","color","i","Math","floor","random","j","k","Pos","constructor","x","y","randomPos","dist","v","pow","move","dx","dy","movev","add","addv","rot","center","angle","clockwise","cos","sin","Player","name","pos","r","sw_angle","PI","sw_r","sw_w","sw_h","sw_speed","hp","xp","randomPlayer","randomName","alphabet","length","p","trytohit","enemy","sp","sw_pos","w","h","pos_x_line_meet","p1","p2","line_circle_meet","a","b","c","d","abs","meet_cnt","dir","tmp","trytoeat","item","bound","sw_rot","hp_change","dhp","dead","Item","randomItem","eaten","player"],"mappings":"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","sourcesContent":["var mapSize = 1200;\n\nfunction getRandomColor() {\n    var letters = '6789ABCDEF';\n    var color = '#';\n    let i = Math.floor(Math.random()*3);\n    for(let j=0;j<3;j++){\n        if(j==i) color+='FF';\n        else for (var k = 0; k < 2; k++) {\n            color += letters[Math.floor(Math.random() * 10)];\n        }\n    }\n    return color;\n}\n\nclass Pos{\n    constructor(x,y){\n        this.x=x;\n        this.y=y;\n    }\n\n    static randomPos(){\n        let x = Math.random() * 2 * mapSize - mapSize;\n        let y = Math.random() * 2 * mapSize - mapSize;\n        return new Pos(x,y)\n    }\n\n    dist(v){\n        return Math.pow((this.x-v.x)*(this.x-v.x)+(this.y-v.y)*(this.y-v.y),0.5)\n    }\n\n    move(dx,dy){\n        this.x+=dx;\n        this.y+=dy;\n    }\n\n    movev(v){\n        this.x+=v.x;\n        this.y+=v.y;\n    }\n    \n    add(x,y,i=1){\n        return new Pos(this.x+x*i, this.y+y*i)\n    }\n\n    addv(v,i=1){\n        return new Pos(this.x+v.x*i, this.y+v.y*i)\n    }\n\n    rot(center,angle,clockwise = true){ // center point, angle in radian\n        if(clockwise)angle*=-1;\n        const x = this.x - center.x\n        const y = this.y - center.y\n        this.x = Math.cos(angle)*x-Math.sin(angle)*y+center.x;\n        this.y = Math.sin(angle)*x+Math.cos(angle)*y+center.y;\n    }\n}\n\nclass Player{\n    constructor(name){\n        this.name = name;\n        this.pos = new Pos(0,0);\n        this.r = 25;\n        this.sw_angle = 0 * (Math.PI/180); // sword angle\n        this.sw_r = 80; // sword radius\n        this.sw_w = 40;\n        this.sw_h = 100;\n        this.sw_speed = 4 * (Math.PI/180);\n        this.hp = 100;\n        this.xp = 0;\n        this.color = getRandomColor();\n    }\n\n    static randomPlayer(){\n        function randomName(){\n            let alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\n            let name = '';\n            for(let i=0;i<10;i++)\n                name+=alphabet[Math.floor(Math.random()*alphabet.length)]\n            return name;\n        }\n        let p = new Player(randomName())\n        p.pos = Pos.randomPos();\n        return p;\n    }\n\n    trytohit(enemy){\n        let sp = this.sw_pos();\n        let w = this.sw_w;\n        let h = this.sw_h;\n        function pos_x_line_meet(p1,p2,p){\n            return (p.y-p1.y)*(p.x-p2.x)/(p1.y-p2.y)+p1.x>p.x &&\n                (p.y-p1.y)*(p.y-p2.y)<0;\n        }\n        function line_circle_meet(p1,p2,p,r){\n            let a=p2.y-p1.y,b=p1.x-p2.x,c=p1.x*(p1.y-p2.y)+p1.y*(p2.x-p1.x);\n            let d = Math.abs(a*p.x+b*p.y+c)/Math.pow(a*a+b*b,0.5)\n            return d<r;\n        }\n        let meet_cnt = 0;\n        let dir = [1,1];\n        for(let i=0;i<4;i++){\n            let p1 = new Pos(sp.x+w*dir[0],sp.y+h*dir[1]);\n            let p2 = new Pos(sp.x+w*dir[0],sp.y-h*dir[1]);\n            if(pos_x_line_meet(p1,p2,enemy.pos))meet_cnt++;\n            if(line_circle_meet(p1,p2,enemy.pos,enemy.r)){\n                meet_cnt=1;\n                break;\n            }\n            let tmp = dir[0];\n            dir[0]=-dir[1];\n            dir[1]=tmp;\n        }\n        return meet_cnt%2 === 1\n    }\n\n    trytoeat(item){\n        const p = this.pos;\n        const i = item.pos;\n        return Math.pow(i.x-p.x,2)+Math.pow(i.y-p.y,2)<=Math.pow(this.r+item.r,2)\n    }\n\n    move(dx,dy){\n        this.pos.move(dx,dy)\n        this.bound()\n    }\n\n    bound(){\n        if(this.pos.x>=mapSize)this.pos.x=mapSize;\n        if(this.pos.y>=mapSize)this.pos.y=mapSize;\n        if(this.pos.x<=-mapSize)this.pos.x=-mapSize;\n        if(this.pos.y<=-mapSize)this.pos.y=-mapSize;\n    }\n\n    sw_rot(angle,clockwise=true){\n        if(clockwise)angle*=-1;\n        this.sw_angle+=angle;\n        this.sw_angle%=(2*Math.PI);\n    }\n\n    sw_pos(){\n        return this.pos.add(this.sw_r,0).rot(this.pos,this.sw_angle);\n    }\n\n    hp_change(dhp){\n        this.hp+=dhp;\n    }\n\n    dead(){\n        return (this.hp <= 0)\n    }\n}\n\n\n\nclass Item{\n    constructor(pos){\n        this.pos = pos; \n        this.color = getRandomColor();\n        this.xp = Math.floor(Math.random() * 16)+1;\n        this.r = Math.floor(Math.random() * 3)+3;\n    }\n\n    static randomItem(){\n        return new Item(Pos.randomPos())\n    }\n\n    eaten(player){\n        player.xp+=this.xp;\n        this.constructor(Pos.randomPos())\n    }\n}\n\nexport {Player, Pos, Item}"]},"metadata":{},"sourceType":"module"}