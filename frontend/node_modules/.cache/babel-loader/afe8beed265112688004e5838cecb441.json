{"ast":null,"code":"var mapSize = 3000;\n\nfunction getRandomId() {\n  var letters = 'HONGENGIisworkingreallyhard';\n  var id = '';\n\n  for (let i = 0; i < 6; i++) {\n    id += letters[Math.floor(Math.random() * letters.length)];\n  }\n\n  return id;\n}\n\nfunction getRandomColor() {\n  var letters = '6789ABCDEF';\n  var color = '#';\n  let i = Math.floor(Math.random() * 3);\n\n  for (let j = 0; j < 3; j++) {\n    if (j == i) color += 'FF';else for (var k = 0; k < 2; k++) {\n      color += letters[Math.floor(Math.random() * 10)];\n    }\n  }\n\n  return color;\n}\n\nclass Pos {\n  constructor(x, y) {\n    this.x = x;\n    this.y = y;\n  }\n\n  static randomPos() {\n    let x = Math.random() * 2 * mapSize - mapSize;\n    let y = Math.random() * 2 * mapSize - mapSize;\n    return new Pos(x, y);\n  }\n\n  dist(v2) {\n    return Math.pow((this.x - v2.x) * (this.x - v2.x) + (this.y - v2.y) * (this.y - v2.y), 0.5);\n  }\n\n  move(dx, dy) {\n    this.x += dx;\n    this.y += dy;\n  }\n\n  movev(v) {\n    this.x += v.x;\n    this.y += v.y;\n  }\n\n  add(x, y) {\n    let i = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1;\n    return new Pos(this.x + x * i, this.y + y * i);\n  }\n\n  addv(v) {\n    let i = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n    return new Pos(this.x + v.x * i, this.y + v.y * i);\n  }\n\n  rot(center, angle) {\n    let clockwise = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : true;\n    // center point, angle in radian\n    if (clockwise) angle *= -1;\n    const x = this.x - center.x;\n    const y = this.y - center.y;\n    return new Pos(Math.cos(angle) * x - Math.sin(angle) * y + center.x, Math.sin(angle) * x + Math.cos(angle) * y + center.y);\n  }\n\n}\n\nclass Player {\n  constructor(name) {\n    let x = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;\n    let y = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;\n    this.id = getRandomId();\n    this.name = name;\n    this.pos = new Pos(x, y);\n    this.r = 25;\n    this.speed = new Pos(0, 0);\n    this.sw_angle = 0 * (Math.PI / 180); // sword angle\n\n    this.sw_r = 65; // sword radius\n\n    this.sw_w = 40;\n    this.sw_h = 100;\n    this.sw_speed = 4 * (Math.PI / 180);\n    this.hp = 100;\n    this.xp = 0;\n    this.lv = 1;\n    this.hpmax = 100;\n    this.color = getRandomColor();\n  }\n\n  static randomPlayer() {\n    function randomName() {\n      let alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\n      let name = '';\n\n      for (let i = 0; i < 10; i++) name += alphabet[Math.floor(Math.random() * alphabet.length)];\n\n      return name;\n    }\n\n    let p = new Player(randomName());\n    p.pos = Pos.randomPos();\n    return p;\n  }\n\n  static schemaPlayer(sch) {\n    let newPlayer = new Player();\n    newPlayer.id = sch._id;\n    newPlayer.name = sch.name;\n    newPlayer.pos = new Pos(sch.x, sch.y);\n    newPlayer.speed = new Pos(sch.vx, sch.vy);\n    newPlayer.r = sch.r;\n    newPlayer.sw_angle = sch.sw_angle;\n    newPlayer.sw_r = sch.sw_r;\n    newPlayer.sw_h = sch.sw_h;\n    newPlayer.sw_speed = sch.sw_speed;\n    newPlayer.hp = sch.hp;\n    newPlayer.hpmax = sch.hpmax;\n    newPlayer.xp = sch.xp;\n    newPlayer.lv = sch.lv;\n    newPlayer.color = sch.color;\n    return newPlayer;\n  }\n\n  addSpeed(x, y) {\n    this.speed.move(x, y);\n  }\n\n  trytohit(enemy) {\n    if (enemy.id == this.id) return;\n    let sp = this.sw_pos();\n\n    function pos_x_line_meet(p1, p2, p) {\n      return (p.y - p1.y) * (p.x - p2.x) / (p1.y - p2.y) + p1.x > p.x && (p.y - p1.y) * (p.y - p2.y) < 0;\n    }\n\n    function dist(p1, p) {\n      return Math.pow(Math.pow(p1.x - p.x, 2) + Math.pow(p1.y - p.y, 2), 0.5);\n    }\n\n    function point_circle_meet(p1, p, r) {\n      return dist(p1, p) < r;\n    }\n\n    function angleof3p(pr, p, pl) {\n      let prp = dist(pr, p);\n      let plp = dist(pl, p);\n      let prl = dist(pr, pl);\n      return Math.acos((prp * prp + plp * plp + prl * prl) / (2 * prp * plp));\n    }\n\n    function line_circle_meet(p1, p2, p, r) {\n      let a = p2.y - p1.y,\n          b = p1.x - p2.x,\n          c = p1.x * (p1.y - p2.y) + p1.y * (p2.x - p1.x);\n      let d = Math.abs(a * p.x + b * p.y + c) / Math.pow(a * a + b * b, 0.5);\n\n      if (d < r) {\n        return angleof3p(p, p1, p2) < Math.PI / 2 && angleof3p(p, p2, p1) < Math.PI / 2;\n      }\n    }\n\n    let meet_cnt = 0;\n    let w = this.sw_w / 2;\n    let h = this.sw_h / 2;\n    let alpha = Math.atan(w / h);\n    let beta = this.sw_angle - alpha;\n    let r = Math.pow(w * w + h * h, 0.5);\n    var dir = [new Pos(0, -r).rot(new Pos(0, 0), beta), new Pos(0, -r).rot(new Pos(0, 0), beta + 2 * alpha)];\n\n    for (let i = 0; i < 4; i++) {\n      let p1 = sp.addv(dir[0]);\n      let p2 = sp.addv(dir[1]);\n\n      if (pos_x_line_meet(p1, p2, enemy.pos)) {\n        meet_cnt++;\n      }\n\n      if (point_circle_meet(p1, enemy.pos, enemy.r) || line_circle_meet(p1, p2, enemy.pos, enemy.r)) {\n        meet_cnt = 1;\n        break;\n      }\n\n      let tmp = dir[0];\n      dir[0] = new Pos(0, 0).addv(dir[1], -1);\n      dir[1] = tmp;\n    }\n\n    return meet_cnt % 2 === 1;\n  }\n\n  trytoeat(item) {\n    const p = this.pos;\n    const i = item.pos;\n    return Math.pow(i.x - p.x, 2) + Math.pow(i.y - p.y, 2) <= Math.pow(this.r + item.r, 2);\n  }\n\n  accel() {\n    this.speed.move(-this.speed.x / 15, -this.speed.y / 15);\n  }\n\n  move(dx, dy) {\n    this.pos.movev(this.speed);\n    this.accel();\n    this.bound();\n  }\n\n  bound() {\n    if (this.pos.x >= mapSize) this.pos.x = mapSize + (this.pos.x - mapSize) / 2;\n    if (this.pos.y >= mapSize) this.pos.y = mapSize;\n    if (this.pos.x <= -mapSize) this.pos.x = -mapSize;\n    if (this.pos.y <= -mapSize) this.pos.y = -mapSize;\n  }\n\n  sw_rot(angle) {\n    let clockwise = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;\n    if (clockwise) angle *= -1;\n    this.sw_angle += angle;\n    this.sw_angle %= 2 * Math.PI;\n  }\n\n  sw_pos() {\n    let p = this.pos.add(0, -this.r - this.sw_r);\n    return p.rot(this.pos, this.sw_angle);\n  }\n\n  damage(dhp) {\n    this.hp = Math.max(0, this.hp - dhp);\n  }\n\n  dead() {\n    return this.hp == 0;\n  }\n\n  xpup(xp) {\n    this.xp += xp;\n    this.r = Math.pow(25 * 25 + this.xp, 0.5);\n    if (Math.pow(this.xp / 50, 0.5) > this.lv) this.lvup();\n  }\n\n  lvup() {\n    this.lv += 1;\n    this.hpmax += 25;\n    this.hp += 25;\n  }\n\n}\n\nclass Item {\n  constructor(pos) {\n    this.init(pos);\n    this.id = getRandomId();\n  }\n\n  init(pos) {\n    this.pos = pos;\n    this.color = getRandomColor();\n    this.xp = Math.floor(Math.random() * 16) + 1;\n    this.r = Math.floor(Math.random() * 10) + 3;\n  }\n\n  static schemaItem(sch) {\n    let newItem = new Item();\n    newItem.id = sch._id;\n    newItem.pos = new Pos(sch.x, sch.y);\n    newItem.color = sch.color;\n    newItem.xp = sch.xp;\n    newItem.r = sch.r;\n    return newItem;\n  }\n\n  static randomItem() {\n    return new Item(Pos.randomPos());\n  }\n\n  eaten(player) {\n    player.xpup(this.xp);\n    this.init(Pos.randomPos());\n  }\n\n}\n\nexport { Player, Pos, Item };","map":{"version":3,"sources":["/Users/hong-eungi/git/tourne-sabre/frontend/src/object.js"],"names":["mapSize","getRandomId","letters","id","i","Math","floor","random","length","getRandomColor","color","j","k","Pos","constructor","x","y","randomPos","dist","v2","pow","move","dx","dy","movev","v","add","addv","rot","center","angle","clockwise","cos","sin","Player","name","pos","r","speed","sw_angle","PI","sw_r","sw_w","sw_h","sw_speed","hp","xp","lv","hpmax","randomPlayer","randomName","alphabet","p","schemaPlayer","sch","newPlayer","_id","vx","vy","addSpeed","trytohit","enemy","sp","sw_pos","pos_x_line_meet","p1","p2","point_circle_meet","angleof3p","pr","pl","prp","plp","prl","acos","line_circle_meet","a","b","c","d","abs","meet_cnt","w","h","alpha","atan","beta","dir","tmp","trytoeat","item","accel","bound","sw_rot","damage","dhp","max","dead","xpup","lvup","Item","init","schemaItem","newItem","randomItem","eaten","player"],"mappings":"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","sourcesContent":["var mapSize = 3000;\nfunction getRandomId(){\n    var letters = 'HONGENGIisworkingreallyhard'\n    var id = '';\n    for(let i=0;i<6;i++){\n        id += letters[Math.floor(Math.random()*letters.length)]\n    }\n    return id;\n}\n\nfunction getRandomColor() {\n    var letters = '6789ABCDEF';\n    var color = '#';\n    let i = Math.floor(Math.random()*3);\n    for(let j=0;j<3;j++){\n        if(j==i) color+='FF';\n        else for (var k = 0; k < 2; k++) {\n            color += letters[Math.floor(Math.random() * 10)];\n        }\n    }\n    return color;\n}\n\nclass Pos{\n    constructor(x,y){\n        this.x=x;\n        this.y=y;\n    }\n\n    static randomPos(){\n        let x = Math.random() * 2 * mapSize - mapSize;\n        let y = Math.random() * 2 * mapSize - mapSize;\n        return new Pos(x,y)\n    }\n\n    dist(v2){\n        return Math.pow((this.x-v2.x)*(this.x-v2.x)+(this.y-v2.y)*(this.y-v2.y),0.5)\n    }\n\n    move(dx,dy){\n        this.x+=dx;\n        this.y+=dy;\n    }\n\n    movev(v){\n        this.x+=v.x;\n        this.y+=v.y;\n    }\n    \n    add(x,y,i=1){\n        return new Pos(this.x+x*i, this.y+y*i)\n    }\n\n    addv(v,i=1){\n        return new Pos(this.x+v.x*i, this.y+v.y*i)\n    }\n\n    rot(center,angle,clockwise = true){ // center point, angle in radian\n        if(clockwise)angle*=-1;\n        const x = this.x - center.x\n        const y = this.y - center.y\n        return new Pos(Math.cos(angle)*x-Math.sin(angle)*y+center.x,Math.sin(angle)*x+Math.cos(angle)*y+center.y)\n    }\n}\n\nclass Player{\n    constructor(name,x=0,y=0){\n        this.id = getRandomId();\n        this.name = name;\n        this.pos = new Pos(x,y);\n        this.r = 25;\n        this.speed = new Pos(0,0);\n        this.sw_angle = 0 * (Math.PI/180); // sword angle\n        this.sw_r = 65; // sword radius\n        this.sw_w = 40;\n        this.sw_h = 100;\n        this.sw_speed = 4 * (Math.PI/180);\n        this.hp = 100;\n        this.xp = 0;\n        this.lv = 1;\n        this.hpmax = 100;\n     \n        this.color = getRandomColor();\n    }\n\n    static randomPlayer(){\n        function randomName(){\n            let alphabet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz';\n            let name = '';\n            for(let i=0;i<10;i++)\n                name+=alphabet[Math.floor(Math.random()*alphabet.length)]\n            return name;\n        }\n        let p = new Player(randomName())\n        p.pos = Pos.randomPos();\n        return p;\n    }\n\n    static schemaPlayer(sch){\n        let newPlayer = new Player()\n        newPlayer.id = sch._id\n        newPlayer.name = sch.name\n        newPlayer.pos = new Pos(sch.x,sch.y)\n        newPlayer.speed = new Pos(sch.vx,sch.vy)\n        newPlayer.r = sch.r\n        newPlayer.sw_angle = sch.sw_angle\n        newPlayer.sw_r = sch.sw_r\n        newPlayer.sw_h = sch.sw_h\n        newPlayer.sw_speed = sch.sw_speed\n        newPlayer.hp = sch.hp\n        newPlayer.hpmax = sch.hpmax\n        newPlayer.xp = sch.xp\n        newPlayer.lv = sch.lv\n        newPlayer.color = sch.color\n        return newPlayer\n    }\n\n    addSpeed(x,y){\n        this.speed.move(x,y)\n    }\n\n    trytohit(enemy){\n        if(enemy.id == this.id)return;\n        let sp = this.sw_pos();\n        function pos_x_line_meet(p1,p2,p){\n            return ((p.y-p1.y)*(p.x-p2.x)/(p1.y-p2.y)+p1.x>p.x) &&\n                ((p.y-p1.y)*(p.y-p2.y)<0);\n        }\n        function dist(p1,p){\n            return Math.pow(Math.pow(p1.x-p.x,2)+Math.pow(p1.y-p.y,2),0.5)\n        }\n        function point_circle_meet(p1,p,r){\n            return dist(p1,p)<r\n        }\n        function angleof3p(pr,p,pl){\n            let prp = dist(pr,p)\n            let plp = dist(pl,p)\n            let prl = dist(pr,pl)\n            return Math.acos((prp*prp+plp*plp+prl*prl)/(2*prp*plp))\n        }\n        function line_circle_meet(p1,p2,p,r){\n            let a=p2.y-p1.y,b=p1.x-p2.x,c=p1.x*(p1.y-p2.y)+p1.y*(p2.x-p1.x);\n            let d = Math.abs(a*p.x+b*p.y+c)/Math.pow(a*a+b*b,0.5)\n            if(d<r){\n                return angleof3p(p,p1,p2)<Math.PI/2 && angleof3p(p,p2,p1)<Math.PI/2\n            }\n        }\n        let meet_cnt = 0;\n        let w = this.sw_w/2;\n        let h = this.sw_h/2;\n        let alpha = Math.atan(w/h)\n        let beta = this.sw_angle-alpha\n        let r = Math.pow(w*w+h*h,0.5)\n        var dir = [new Pos(0,-r).rot(new Pos(0,0),beta),\n            new Pos(0,-r).rot(new Pos(0,0),beta+2*alpha)]\n        for(let i=0;i<4;i++){\n            let p1 = sp.addv(dir[0]);\n            let p2 = sp.addv(dir[1]);\n            if(pos_x_line_meet(p1,p2,enemy.pos)){\n                meet_cnt++;\n            }\n            if(point_circle_meet(p1,enemy.pos,enemy.r) || \n                line_circle_meet(p1,p2,enemy.pos,enemy.r)){\n                meet_cnt=1;\n                break;\n            }\n            let tmp = dir[0];\n            dir[0] = new Pos(0,0).addv(dir[1],-1);\n            dir[1]=tmp;\n        }\n        return meet_cnt%2 === 1\n    }\n\n    trytoeat(item){\n        const p = this.pos;\n        const i = item.pos;\n        return Math.pow(i.x-p.x,2)+Math.pow(i.y-p.y,2)<=Math.pow(this.r+item.r,2)\n    }\n\n    accel(){\n        this.speed.move(-this.speed.x/15,-this.speed.y/15)\n    }\n\n    move(dx,dy){\n        this.pos.movev(this.speed)\n        this.accel()\n        this.bound()\n    }\n\n    bound(){\n        if(this.pos.x>=mapSize)this.pos.x=mapSize+(this.pos.x-mapSize)/2;\n        if(this.pos.y>=mapSize)this.pos.y=mapSize;\n        if(this.pos.x<=-mapSize)this.pos.x=-mapSize;\n        if(this.pos.y<=-mapSize)this.pos.y=-mapSize;\n    }\n\n    sw_rot(angle,clockwise=true){\n        if(clockwise)angle*=-1;\n        this.sw_angle+=angle;\n        this.sw_angle%=(2*Math.PI);\n    }\n\n    sw_pos(){\n        let p = this.pos.add(0,-this.r-this.sw_r)\n        return p.rot(this.pos,this.sw_angle);\n    }\n\n    damage(dhp){\n        this.hp=Math.max(0,this.hp-dhp)\n    }\n\n    dead(){\n        return (this.hp == 0)\n    }\n\n    xpup(xp){\n        this.xp+=xp;\n        this.r = Math.pow(25*25+this.xp,0.5)\n        if(Math.pow(this.xp/50,0.5)>this.lv)this.lvup()\n    }\n\n    lvup(){\n        this.lv+=1\n        this.hpmax+=25\n        this.hp+=25\n    }\n}\n\n\n\nclass Item{\n    constructor(pos){\n        this.init(pos)\n        this.id = getRandomId();\n    }\n\n    init(pos){\n        this.pos = pos; \n        this.color = getRandomColor();\n        this.xp = Math.floor(Math.random() * 16)+1;\n        this.r = Math.floor(Math.random() * 10)+3;\n    }\n\n    static schemaItem(sch){\n        let newItem = new Item()\n        newItem.id = sch._id\n        newItem.pos = new Pos(sch.x,sch.y)\n        newItem.color = sch.color\n        newItem.xp = sch.xp\n        newItem.r = sch.r\n        return newItem\n    }\n\n    static randomItem(){\n        return new Item(Pos.randomPos())\n    }\n\n    eaten(player){\n        player.xpup(this.xp)\n        this.init(Pos.randomPos())\n    }\n}\n\nexport {Player, Pos, Item}"]},"metadata":{},"sourceType":"module"}