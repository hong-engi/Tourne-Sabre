{"ast":null,"code":"import sword from './sword.png';\nimport { map } from './map.js';\nimport { Pos, Player, Item } from './object.js';\nconst canvas_size = 1000;\nconst center_h = canvas_size / 2;\nconst center_w = canvas_size / 2;\nvar img = new Image();\nimg.src = sword; //todo : canvas.width,canvas.height??\n\nfunction draw(ctx, me) {\n  ctx.fillStyle = 'white';\n  ctx.fillRect(0, 0, canvas_size, canvas_size);\n\n  if (me != null) {\n    for (let i = 0; i < map.itemList.length; i++) {\n      let item = Item.schemaItem(map.itemList[i]);\n\n      if (me.pos.dist(item.pos) < 550) {\n        drawItem(ctx, me, item);\n      }\n    }\n\n    for (let i = 0; i < map.playerList.length; i++) {\n      let player = Player.schemaPlayer(map.playerList[i]);\n\n      if (me.id == player.id) {\n        me = player;\n      }\n\n      drawPlayer(ctx, me, player);\n      drawSword(ctx, me, player);\n    }\n    /*\n    ctx.fillStyle = 'purple'\n    let sp = me.sw_pos()\n    var circle = new Path2D();\n    circle.arc(center_w+sp.x-me.pos.x, center_h+sp.y-me.pos.y, 3, 0, 2 * Math.PI);\n    circle.arc(center_w-me.pos.x, center_h-me.pos.y, 3, 0, 2 * Math.PI);\n    ctx.fill(circle);\n    */\n\n    /*\n    let w = me.sw_w/2;\n    let h = me.sw_h/2;\n    let alpha = Math.atan(w/h)\n    let beta = me.sw_angle-alpha\n    let r = Math.pow(w*w+h*h,0.5)\n    var dir = [new Pos(0,-r).rot(new Pos(0,0),beta),\n        new Pos(0,-r).rot(new Pos(0,0),beta+2*alpha)]\n    for(let i=0;i<4;i++){\n        let xx = new Path2D();\n        let p1 = sp.addv(dir[0]);\n        ctx.fillStyle = 'blue'\n        xx.arc(center_w+p1.x-me.pos.x, center_h+p1.y-me.pos.y, 3, 0, 2 * Math.PI);\n        ctx.fill(xx);\n        let tmp = dir[0];\n        dir[0] = new Pos(0,0).addv(dir[1],-1);\n        dir[1] = tmp;\n    }\n    */\n\n  }\n\n  defaultMap(ctx);\n\n  if (me != null) {\n    ctx.font = '20px Dosis-Bold';\n    ctx.fillStyle = 'green';\n    let text = '(' + String(Math.round(me.pos.x)) + ',' + String(Math.round(me.pos.y)) + ')';\n    ctx.fillText(text, 100, 200);\n  }\n}\n\nfunction defaultMap(ctx) {\n  ctx.StrokeStyle = 'black';\n  ctx.fillStyle = 'black';\n  ctx.beginPath();\n  ctx.moveTo(0, 0);\n  ctx.lineTo(canvas_size, 0);\n  ctx.lineTo(canvas_size, canvas_size);\n  ctx.lineTo(0, canvas_size);\n  ctx.lineTo(0, 0);\n  ctx.closePath();\n  ctx.arc(center_w, center_h, 400, 0, Math.PI * 2, true);\n  ctx.closePath();\n  ctx.fill();\n}\n\nfunction drawItem(ctx, me, i) {\n  var circle = new Path2D();\n  let dpos = i.pos.addv(me.pos, -1),\n      x = center_w + dpos.x,\n      y = center_h + dpos.y;\n  circle.arc(x, y, i.r, 0, 2 * Math.PI);\n  ctx.fillStyle = i.color;\n  ctx.strokeStyle = 'black';\n  ctx.lineWidth = 0.5;\n  ctx.fill(circle);\n  ctx.stroke(circle);\n}\n\nfunction drawPlayer(ctx, me, p) {\n  if (me.pos.dist(p.pos) > 400 + p.r) {\n    var circle = new Path2D();\n    let dpos = p.pos.addv(me.pos, -1),\n        x = dpos.x,\n        y = dpos.y;\n    let r = me.pos.dist(p.pos);\n    let angle = Math.atan(y / x);\n    if (x < 0) angle += ctx.fillStyle = p.color;\n    ctx.strokeStyle = 'black';\n    ctx.lineWidth = 1;\n    ctx.save();\n    ctx.beginPath();\n    ctx.translate(center_w, center_h);\n    ctx.rotate(angle);\n    ctx.moveTo(400, 0);\n    ctx.lineTo(380, -20);\n    ctx.lineTo(380, 20);\n    ctx.lineTo(400, 0);\n    ctx.closePath();\n    ctx.fill();\n    ctx.restore();\n  } else {\n    if (me.id == p.id) {\n      p = me;\n    }\n\n    var circle = new Path2D();\n    let dpos = p.pos.addv(me.pos, -1),\n        x = center_w + dpos.x,\n        y = center_h + dpos.y;\n    circle.arc(x, y, p.r, 0, 2 * Math.PI);\n    ctx.fillStyle = p.color;\n    if (me.id == p.id) ctx.fillStyle = 'red';\n    ctx.strokeStyle = 'black';\n    ctx.lineWidth = 1;\n    ctx.fill(circle);\n    ctx.stroke(circle);\n    drawString(ctx, me, p);\n    drawHealthbar(ctx, me, p);\n  }\n}\n\nfunction drawHealthbar(ctx, me, p) {\n  let dpos = p.pos.addv(me.pos, -1),\n      x = center_w + dpos.x,\n      y = center_h + dpos.y;\n  ctx.strokeStyle = '#77FF77';\n  ctx.fillStyle = '#77FF77';\n  ctx.lineWidth = 2;\n  ctx.fillRect(x - p.r, y + p.r + 3, 2 * p.r * p.hp / p.hpmax, 10);\n  ctx.strokeStyle = '#77FF77';\n  ctx.fillStyle = \"rgba(0, 0, 0, 0.2)\";\n  ctx.fillRect(x - p.r, y + p.r + 3, 2 * p.r, 10);\n}\n\nfunction drawSword(ctx, me, p) {\n  if (me.pos.dist(p.pos) > 400 + p.r + p.sw_r) return;\n  const angle = -p.sw_angle;\n  let dpos = p.pos.addv(me.pos, -1),\n      x = center_w + dpos.x,\n      y = center_h + dpos.y;\n  const r = p.r + p.sw_r,\n        w = p.sw_w,\n        h = p.sw_h;\n  ctx.save();\n  ctx.translate(x, y);\n  ctx.rotate(angle);\n  ctx.drawImage(img, -w / 2, -r - h / 2, w, h);\n  ctx.restore();\n}\n\nfunction drawString(ctx, me, p) {\n  let dpos = p.pos.addv(me.pos, -1),\n      x = center_w + dpos.x,\n      y = center_h + dpos.y;\n  ctx.fillStyle = 'black';\n  if (me.id == p.id) ctx.fillStyle = 'white';\n  ctx.font = String(p.r * 15 / 25) + 'px Dosis-Bold';\n  let text = p.name;\n  let width = ctx.measureText(text).width;\n  ctx.fillText(text, x - width / 2, y + p.r * 5 / 25);\n  ctx.font = String(Math.max(10, p.r * 10 / 25)) + 'px Dosis-ExtraBold';\n  text = String(p.lv) + ' lv';\n  width = ctx.measureText(text).width;\n  ctx.fillText(text, x - width / 2, y + p.r * 18 / 25);\n}\n\nexport default draw;","map":{"version":3,"sources":["/Users/hong-eungi/git/tourne-sabre/frontend/src/mapdraw.js"],"names":["sword","map","Pos","Player","Item","canvas_size","center_h","center_w","img","Image","src","draw","ctx","me","fillStyle","fillRect","i","itemList","length","item","schemaItem","pos","dist","drawItem","playerList","player","schemaPlayer","id","drawPlayer","drawSword","defaultMap","font","text","String","Math","round","x","y","fillText","StrokeStyle","beginPath","moveTo","lineTo","closePath","arc","PI","fill","circle","Path2D","dpos","addv","r","color","strokeStyle","lineWidth","stroke","p","angle","atan","save","translate","rotate","restore","drawString","drawHealthbar","hp","hpmax","sw_r","sw_angle","w","sw_w","h","sw_h","drawImage","name","width","measureText","max","lv"],"mappings":"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","sourcesContent":["import sword from './sword.png'\nimport {map} from './map.js'\nimport {Pos, Player, Item} from './object.js'\nconst canvas_size = 1000;\nconst center_h = canvas_size/2;\nconst center_w = canvas_size/2;\n\nvar img = new Image();\nimg.src = sword; \n\n//todo : canvas.width,canvas.height??\nfunction draw(ctx,me) {\n\n    ctx.fillStyle='white'\n    ctx.fillRect(0,0,canvas_size,canvas_size);\n    if(me!=null){\n        for(let i=0;i<map.itemList.length;i++){\n            let item = Item.schemaItem(map.itemList[i])\n            if(me.pos.dist(item.pos)<550){\n                drawItem(ctx,me,item)\n            }\n        }\n\n        for(let i=0;i<map.playerList.length;i++){\n            let player = Player.schemaPlayer(map.playerList[i])\n            if(me.id == player.id) {me=player}\n            drawPlayer(ctx,me,player)\n            drawSword(ctx,me,player)\n        }\n\n        /*\n        ctx.fillStyle = 'purple'\n        let sp = me.sw_pos()\n        var circle = new Path2D();\n        circle.arc(center_w+sp.x-me.pos.x, center_h+sp.y-me.pos.y, 3, 0, 2 * Math.PI);\n        circle.arc(center_w-me.pos.x, center_h-me.pos.y, 3, 0, 2 * Math.PI);\n        ctx.fill(circle);\n        */\n        /*\n        let w = me.sw_w/2;\n        let h = me.sw_h/2;\n        let alpha = Math.atan(w/h)\n        let beta = me.sw_angle-alpha\n        let r = Math.pow(w*w+h*h,0.5)\n        var dir = [new Pos(0,-r).rot(new Pos(0,0),beta),\n            new Pos(0,-r).rot(new Pos(0,0),beta+2*alpha)]\n        for(let i=0;i<4;i++){\n            let xx = new Path2D();\n            let p1 = sp.addv(dir[0]);\n            ctx.fillStyle = 'blue'\n            xx.arc(center_w+p1.x-me.pos.x, center_h+p1.y-me.pos.y, 3, 0, 2 * Math.PI);\n            ctx.fill(xx);\n            let tmp = dir[0];\n            dir[0] = new Pos(0,0).addv(dir[1],-1);\n            dir[1] = tmp;\n        }\n        */\n    }\n    defaultMap(ctx)\n\n    if(me!=null){\n        ctx.font = '20px Dosis-Bold';\n        ctx.fillStyle = 'green'\n        let text = '('+String(Math.round(me.pos.x))+','+String(Math.round(me.pos.y))+')'\n        ctx.fillText(text,100,200)\n    }\n}\n\nfunction defaultMap(ctx){\n    ctx.StrokeStyle='black'\n    ctx.fillStyle='black'\n    ctx.beginPath()\n    ctx.moveTo(0, 0);\n    ctx.lineTo(canvas_size, 0);\n    ctx.lineTo(canvas_size,canvas_size);\n    ctx.lineTo(0, canvas_size);\n    ctx.lineTo(0,0);\n    ctx.closePath();\n    ctx.arc(center_w,center_h,400,0,Math.PI*2,true);\n    ctx.closePath();\n    ctx.fill();\n}\n\nfunction drawItem(ctx,me,i){\n    var circle = new Path2D();\n    let dpos = i.pos.addv(me.pos,-1), x=center_w+dpos.x, y=center_h+dpos.y;\n    circle.arc(x, y, i.r, 0, 2 * Math.PI);\n    ctx.fillStyle=i.color;\n    ctx.strokeStyle='black';\n    ctx.lineWidth=0.5;\n    ctx.fill(circle);\n    ctx.stroke(circle);\n}\n\nfunction drawPlayer(ctx,me,p){\n    if(me.pos.dist(p.pos)>400+p.r){\n        var circle = new Path2D();\n        let dpos = p.pos.addv(me.pos,-1), x=dpos.x, y=dpos.y;\n        let r = me.pos.dist(p.pos)\n        let angle = Math.atan(y/x)\n        if(x<0)angle+=\n        ctx.fillStyle=p.color;\n        ctx.strokeStyle='black';\n        ctx.lineWidth=1;\n        ctx.save();\n            ctx.beginPath()\n            ctx.translate(center_w,center_h);\n            ctx.rotate(angle);\n            ctx.moveTo(400, 0);\n            ctx.lineTo(380,-20);\n            ctx.lineTo(380, 20);\n            ctx.lineTo(400,0);\n            ctx.closePath();\n            ctx.fill()\n        ctx.restore();\n    }\n    else{\n        if(me.id == p.id){p=me}\n        var circle = new Path2D();\n        let dpos = p.pos.addv(me.pos,-1), x=center_w+dpos.x, y=center_h+dpos.y;\n        circle.arc(x, y, p.r, 0, 2 * Math.PI);\n        ctx.fillStyle=p.color;\n        if(me.id == p.id)ctx.fillStyle='red';\n        ctx.strokeStyle='black';\n        ctx.lineWidth=1;\n        ctx.fill(circle);\n        ctx.stroke(circle);\n        drawString(ctx,me,p)\n        drawHealthbar(ctx,me,p)\n    }\n}\n\nfunction drawHealthbar(ctx,me,p){\n    let dpos = p.pos.addv(me.pos,-1), x=center_w+dpos.x, y=center_h+dpos.y;\n    ctx.strokeStyle = '#77FF77'\n    ctx.fillStyle = '#77FF77'\n    ctx.lineWidth=2;\n    ctx.fillRect(x-p.r,y+p.r+3,2*p.r*p.hp/p.hpmax,10)\n    ctx.strokeStyle = '#77FF77'\n    ctx.fillStyle = \"rgba(0, 0, 0, 0.2)\";\n    ctx.fillRect(x-p.r,y+p.r+3,2*p.r,10)\n}\n\nfunction drawSword(ctx,me,p){\n    if(me.pos.dist(p.pos)>400+p.r+p.sw_r)return\n    const angle = -p.sw_angle;\n    let dpos = p.pos.addv(me.pos,-1), x=center_w+dpos.x, y=center_h+dpos.y;\n    const r = p.r+p.sw_r,w=p.sw_w,h=p.sw_h;\n    ctx.save();\n        ctx.translate(x,y);\n        ctx.rotate(angle);\n        ctx.drawImage(img,-w/2,-r-h/2,w,h);\n    ctx.restore();\n}\n\nfunction drawString(ctx,me,p){\n    let dpos = p.pos.addv(me.pos,-1), x=center_w+dpos.x, y=center_h+dpos.y;\n    ctx.fillStyle='black';\n    if(me.id == p.id)ctx.fillStyle='white';\n    ctx.font = String(p.r*15/25)+'px Dosis-Bold';\n    let text = p.name\n    let width = ctx.measureText(text).width;\n    ctx.fillText(text,x-(width/2),y+(p.r*5/25))\n\n    ctx.font = String(Math.max(10,p.r*10/25))+'px Dosis-ExtraBold';\n    text = String(p.lv)+' lv'\n    width = ctx.measureText(text).width;\n    ctx.fillText(text,x-(width/2),y+(p.r*18/25))\n\n}\n\nexport default draw;"]},"metadata":{},"sourceType":"module"}