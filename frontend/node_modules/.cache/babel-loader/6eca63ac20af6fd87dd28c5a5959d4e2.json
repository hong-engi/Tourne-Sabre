{"ast":null,"code":"import sword from './sword.png';\nimport { map } from './map.js';\nimport { Pos, Player, Item } from './object.js';\nconst canvas_size = 1200;\nconst center_h = canvas_size / 2;\nconst center_w = canvas_size / 2;\nvar img = new Image();\nimg.src = sword; //todo : canvas.width,canvas.height??\n\nfunction draw(ctx, player) {\n  ctx.fillStyle = 'white';\n  ctx.fillRect(0, 0, canvas_size, canvas_size);\n  defaultMap(ctx);\n\n  for (let i = 0; i < map.itemList.length; i++) {\n    let item = Item.schemaItem(map.itemList[i]);\n\n    if (player.pos.dist(item.pos) < 550) {\n      drawItem(ctx, player, item);\n    }\n  }\n\n  for (let i = 0; i < map.playerList.length; i++) {\n    let player2 = Player.schemaPlayer(map.playerList[i]);\n\n    if (player.pos.dist(player2.pos) < 550) {\n      drawPlayer(ctx, player, player2);\n    }\n  } //drawing a hole\n\n\n  ctx.StrokeStyle = 'black';\n  ctx.fillStyle = 'black';\n  ctx.beginPath();\n  ctx.moveTo(0, 0);\n  ctx.lineTo(canvas_size, 0);\n  ctx.lineTo(canvas_size, canvas_size);\n  ctx.lineTo(0, canvas_size);\n  ctx.lineTo(0, 0);\n  ctx.closePath();\n  ctx.arc(center_w, center_h, 400, 0, Math.PI * 2, true);\n  ctx.closePath();\n  ctx.fill();\n  ctx.fillStyle = 'purple';\n  let sp = player.sw_pos();\n  var circle = new Path2D();\n  circle.arc(center_w + sp.x - player.pos.x, center_h + sp.y - player.pos.y, 3, 0, 2 * Math.PI);\n  circle.arc(center_w - player.pos.x, center_h - player.pos.y, 3, 0, 2 * Math.PI);\n  ctx.fill(circle);\n  ctx.font = '20px Dosis-Bold';\n  ctx.fillStyle = 'white';\n  let text = '(' + String(Math.round(player.pos.x)) + ',' + String(Math.round(player.pos.y)) + ')';\n  ctx.fillText(text, 200, 300);\n  let w = player.sw_w;\n  let h = 0;\n  let alpha = Math.atan(w / h);\n  let beta = player.sw_angle - alpha;\n  let r = Math.pow(w * w + h * h, 0.5) / 2;\n  var dir = [sp.add(0, -r).rot(sp, beta), sp.add(0, -r).rot(sp, beta + 2 * alpha)];\n\n  for (let i = 0; i < 4; i++) {\n    let xx = new Path2D();\n    let p1 = sp.addv(dir[0]);\n    ctx.fillStyle = 'blue';\n    xx.arc(center_w + p1.x - player.pos.x, center_h + p1.y - player.pos.y, 3, 0, 2 * Math.PI);\n    ctx.fill(xx);\n    let tmp = dir[0];\n    dir[0] = new Pos(0, 0).addv(dir[1], -1);\n    dir[1] = tmp;\n  }\n}\n\nfunction defaultMap(ctx) {\n  var circle = new Path2D();\n  circle.arc(center_h, center_w, 400, 0, 2 * Math.PI);\n  ctx.fillStyle = 'white';\n  ctx.strokeStyle = 'gray';\n  ctx.lineWidth = 5;\n  ctx.fill(circle);\n  ctx.stroke(circle);\n}\n\nfunction drawItem(ctx, me, i) {\n  var circle = new Path2D();\n  let dpos = i.pos.addv(me.pos, -1),\n      x = center_w + dpos.x,\n      y = center_h + dpos.y;\n  circle.arc(x, y, i.r, 0, 2 * Math.PI);\n  ctx.fillStyle = i.color;\n  ctx.strokeStyle = 'black';\n  ctx.lineWidth = 0.5;\n  ctx.fill(circle);\n  ctx.stroke(circle);\n}\n\nfunction drawPlayer(ctx, me, p) {\n  var circle = new Path2D();\n  let dpos = p.pos.addv(me.pos, -1),\n      x = center_w + dpos.x,\n      y = center_h + dpos.y;\n\n  if (me.id == p.id) {\n    x = center_w;\n    y = center_h;\n  }\n\n  circle.arc(x, y, p.r, 0, 2 * Math.PI);\n  ctx.fillStyle = p.color;\n  if (me.id == p.id) ctx.fillStyle = 'red';\n  ctx.strokeStyle = 'black';\n  ctx.lineWidth = 1;\n  ctx.fill(circle);\n  ctx.stroke(circle);\n  drawSword(ctx, me, p);\n  drawString(ctx, me, p);\n  drawHealthbar(ctx, me, p);\n}\n\nfunction drawHealthbar(ctx, me, p) {\n  let dpos = p.pos.addv(me.pos, -1),\n      x = center_w + dpos.x,\n      y = center_h + dpos.y;\n\n  if (me.id == p.id) {\n    x = center_w;\n    y = center_h;\n  }\n\n  ctx.strokeStyle = '#77FF77';\n  ctx.fillStyle = '#77FF77';\n  ctx.lineWidth = 2;\n  ctx.fillRect(x - p.r, y + p.r + 3, 2 * p.r * p.hp / 100, 10);\n  ctx.strokeStyle = '#77FF77';\n  ctx.fillStyle = \"rgba(0, 0, 0, 0.2)\";\n  ctx.fillRect(x - p.r, y + p.r + 3, 2 * p.r, 10);\n}\n\nfunction drawSword(ctx, me, p) {\n  const angle = -p.sw_angle;\n  let dpos = p.pos.addv(me.pos, -1),\n      x = center_w + dpos.x,\n      y = center_h + dpos.y;\n\n  if (me.id == p.id) {\n    x = center_w;\n    y = center_h;\n  }\n\n  const r = p.r + p.sw_r,\n        w = p.sw_w,\n        h = p.sw_h;\n  ctx.save();\n  ctx.translate(x, y);\n  ctx.rotate(angle);\n  ctx.drawImage(img, -w / 2, -r - h / 2, w, h);\n  ctx.fillRect(-w / 2, -r - h / 2, w, h);\n  ctx.restore();\n}\n\nfunction drawString(ctx, me, p) {\n  let dpos = p.pos.addv(me.pos, -1),\n      x = center_w + dpos.x,\n      y = center_h + dpos.y;\n\n  if (me.id == p.id) {\n    x = center_w;\n    y = center_h;\n  }\n\n  ctx.fillStyle = 'black';\n  if (me.id == p.id) ctx.fillStyle = 'white';\n  ctx.font = '15px Dosis-Bold';\n  let text = p.name;\n  let width = ctx.measureText(text).width;\n  ctx.fillText(text, x - width / 2, y + 5);\n}\n\nexport default draw;","map":{"version":3,"sources":["/Users/hong-eungi/git/tourne-sabre/frontend/src/mapdraw.js"],"names":["sword","map","Pos","Player","Item","canvas_size","center_h","center_w","img","Image","src","draw","ctx","player","fillStyle","fillRect","defaultMap","i","itemList","length","item","schemaItem","pos","dist","drawItem","playerList","player2","schemaPlayer","drawPlayer","StrokeStyle","beginPath","moveTo","lineTo","closePath","arc","Math","PI","fill","sp","sw_pos","circle","Path2D","x","y","font","text","String","round","fillText","w","sw_w","h","alpha","atan","beta","sw_angle","r","pow","dir","add","rot","xx","p1","addv","tmp","strokeStyle","lineWidth","stroke","me","dpos","color","p","id","drawSword","drawString","drawHealthbar","hp","angle","sw_r","sw_h","save","translate","rotate","drawImage","restore","name","width","measureText"],"mappings":"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","sourcesContent":["import sword from './sword.png'\nimport {map} from './map.js'\nimport {Pos, Player, Item} from './object.js'\nconst canvas_size = 1200;\nconst center_h = canvas_size/2;\nconst center_w = canvas_size/2;\n\nvar img = new Image();\nimg.src = sword; \n\n//todo : canvas.width,canvas.height??\nfunction draw(ctx,player) {\n\n    ctx.fillStyle='white'\n    ctx.fillRect(0,0,canvas_size,canvas_size);\n    defaultMap(ctx)\n\n    for(let i=0;i<map.itemList.length;i++){\n        let item = Item.schemaItem(map.itemList[i])\n        if(player.pos.dist(item.pos)<550){\n            drawItem(ctx,player,item)\n        }\n    }\n\n    for(let i=0;i<map.playerList.length;i++){\n        let player2 = Player.schemaPlayer(map.playerList[i])\n        if(player.pos.dist(player2.pos)<550){\n            drawPlayer(ctx,player,player2)\n        }\n    }\n\n    //drawing a hole\n    ctx.StrokeStyle='black'\n    ctx.fillStyle='black'\n    ctx.beginPath()\n    ctx.moveTo(0, 0);\n    ctx.lineTo(canvas_size, 0);\n    ctx.lineTo(canvas_size,canvas_size);\n    ctx.lineTo(0, canvas_size);\n    ctx.lineTo(0,0);\n    ctx.closePath();\n    ctx.arc(center_w,center_h,400,0,Math.PI*2,true);\n    ctx.closePath();\n    ctx.fill();\n\n    ctx.fillStyle = 'purple'\n    let sp = player.sw_pos()\n    var circle = new Path2D();\n    circle.arc(center_w+sp.x-player.pos.x, center_h+sp.y-player.pos.y, 3, 0, 2 * Math.PI);\n    circle.arc(center_w-player.pos.x, center_h-player.pos.y, 3, 0, 2 * Math.PI);\n    ctx.fill(circle);\n\n    ctx.font = '20px Dosis-Bold';\n    ctx.fillStyle = 'white'\n    let text = '('+String(Math.round(player.pos.x))+','+String(Math.round(player.pos.y))+')'\n    ctx.fillText(text,200,300)\n\n    let w = player.sw_w;\n    let h = 0;\n    let alpha = Math.atan(w/h)\n    let beta = player.sw_angle-alpha\n    let r = Math.pow(w*w+h*h,0.5)/2\n    var dir = [sp.add(0,-r).rot(sp,beta),sp.add(0,-r).rot(sp,beta+2*alpha)]\n    for(let i=0;i<4;i++){\n        let xx = new Path2D();\n        let p1 = sp.addv(dir[0]);\n        ctx.fillStyle = 'blue'\n        xx.arc(center_w+p1.x-player.pos.x, center_h+p1.y-player.pos.y, 3, 0, 2 * Math.PI);\n        ctx.fill(xx);\n        let tmp = dir[0];\n        dir[0] = new Pos(0,0).addv(dir[1],-1);\n        dir[1] = tmp;\n    }\n\n}\n\nfunction defaultMap(ctx){\n    var circle = new Path2D();\n    circle.arc(center_h, center_w, 400, 0, 2 * Math.PI);\n    ctx.fillStyle='white';\n    ctx.strokeStyle='gray';\n    ctx.lineWidth=5;\n    ctx.fill(circle);\n    ctx.stroke(circle);\n}\n\nfunction drawItem(ctx,me,i){\n    var circle = new Path2D();\n    let dpos = i.pos.addv(me.pos,-1), x=center_w+dpos.x, y=center_h+dpos.y;\n    circle.arc(x, y, i.r, 0, 2 * Math.PI);\n    ctx.fillStyle=i.color;\n    ctx.strokeStyle='black';\n    ctx.lineWidth=0.5;\n    ctx.fill(circle);\n    ctx.stroke(circle);\n}\n\nfunction drawPlayer(ctx,me,p){\n    var circle = new Path2D();\n    let dpos = p.pos.addv(me.pos,-1), x=center_w+dpos.x, y=center_h+dpos.y;\n    if(me.id == p.id){x=center_w;y=center_h;}\n    circle.arc(x, y, p.r, 0, 2 * Math.PI);\n    ctx.fillStyle=p.color;\n    if(me.id == p.id)ctx.fillStyle='red';\n    ctx.strokeStyle='black';\n    ctx.lineWidth=1;\n    ctx.fill(circle);\n    ctx.stroke(circle);\n    drawSword(ctx,me,p)\n    drawString(ctx,me,p)\n    drawHealthbar(ctx,me,p)\n}\n\nfunction drawHealthbar(ctx,me,p){\n    let dpos = p.pos.addv(me.pos,-1), x=center_w+dpos.x, y=center_h+dpos.y;\n    if(me.id == p.id){x=center_w;y=center_h;}\n    ctx.strokeStyle = '#77FF77'\n    ctx.fillStyle = '#77FF77'\n    ctx.lineWidth=2;\n    ctx.fillRect(x-p.r,y+p.r+3,2*p.r*p.hp/100,10)\n    ctx.strokeStyle = '#77FF77'\n    ctx.fillStyle = \"rgba(0, 0, 0, 0.2)\";\n    ctx.fillRect(x-p.r,y+p.r+3,2*p.r,10)\n}\n\nfunction drawSword(ctx,me,p){\n    const angle = -p.sw_angle;\n    let dpos = p.pos.addv(me.pos,-1), x=center_w+dpos.x, y=center_h+dpos.y;\n    if(me.id == p.id){x=center_w;y=center_h;}\n    const r = p.r+p.sw_r,w=p.sw_w,h=p.sw_h;\n    ctx.save();\n    ctx.translate(x,y);\n    ctx.rotate(angle);\n    ctx.drawImage(img,-w/2,-r-h/2,w,h);\n    ctx.fillRect(-w/2,-r-h/2,w,h)\n    ctx.restore();\n}\n\nfunction drawString(ctx,me,p){\n    let dpos = p.pos.addv(me.pos,-1), x=center_w+dpos.x, y=center_h+dpos.y;\n    if(me.id == p.id){x=center_w;y=center_h;}\n    ctx.fillStyle='black';\n    if(me.id == p.id)ctx.fillStyle='white';\n    ctx.font = '15px Dosis-Bold';\n    let text = p.name\n    let width = ctx.measureText(text).width;\n    ctx.fillText(text,x-(width/2),y+5)\n}\n\nexport default draw;"]},"metadata":{},"sourceType":"module"}